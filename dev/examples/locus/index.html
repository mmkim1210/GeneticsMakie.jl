<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plotting LocusZoom · GeneticsMakie.jl</title><meta name="title" content="Plotting LocusZoom · GeneticsMakie.jl"/><meta property="og:title" content="Plotting LocusZoom · GeneticsMakie.jl"/><meta property="twitter:title" content="Plotting LocusZoom · GeneticsMakie.jl"/><meta name="description" content="Documentation for GeneticsMakie.jl."/><meta property="og:description" content="Documentation for GeneticsMakie.jl."/><meta property="twitter:description" content="Documentation for GeneticsMakie.jl."/><meta property="og:url" content="https://mmkim1210.github.io/GeneticsMakie.jl/examples/locus/"/><meta property="twitter:url" content="https://mmkim1210.github.io/GeneticsMakie.jl/examples/locus/"/><link rel="canonical" href="https://mmkim1210.github.io/GeneticsMakie.jl/examples/locus/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GeneticsMakie.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../gtf/">Parsing GENCODE</a></li><li><a class="tocitem" href="../summary/">Munging summary statistics</a></li><li><a class="tocitem" href="../genes/">Plotting genes</a></li><li><a class="tocitem" href="../isoforms/">Plotting isoforms</a></li><li class="is-active"><a class="tocitem" href>Plotting LocusZoom</a></li><li><a class="tocitem" href="../gwas/">Plotting GWAS</a></li><li><a class="tocitem" href="../twas/">Plotting TWAS</a></li><li><a class="tocitem" href="../loops/">Plotting loops</a></li><li><a class="tocitem" href="../peaks/">Plotting peaks</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Plotting LocusZoom</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plotting LocusZoom</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mmkim1210/GeneticsMakie.jl/blob/master/docs/src/examples/locus.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Plotting-LocusZooom"><a class="docs-heading-anchor" href="#Plotting-LocusZooom">Plotting LocusZooom</a><a id="Plotting-LocusZooom-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-LocusZooom" title="Permalink"></a></h1><p>After <a href="../gtf/#Parsing-GENCODE">Parsing GENCODE</a> and <a href="../summary/#Munging-summary-statistics">Munging summary statistics</a>, we can now put the pieces together to draw the backbone of a LocusZoom plot.  We focus on <em>ACAN</em> locus as an example, which reaches strong genome-wide significance in GWAS for height. By default, <code>GeneticsMakie.plotlocus!</code> returns a straightforward scatter plot.</p><pre><code class="language-julia hljs">using Pkg
Pkg.add([&quot;GeneticsMakie&quot;, &quot;CairoMakie&quot;, &quot;DataFrames&quot;, &quot;Arrow&quot;, &quot;SnpArrays&quot;])</code></pre><pre><code class="language-julia hljs">using GeneticsMakie, CairoMakie, DataFrames, Arrow, SnpArrays, Downloads
dfs = DataFrame[]
for key in [&quot;height&quot;, &quot;weight&quot;]
    push!(dfs, Arrow.Table(&quot;data/gwas/$(key).arrow&quot;)|&gt; DataFrame)
end
url = &quot;https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_39/GRCh37_mapping/gencode.v39lift37.annotation.gtf.gz&quot;
gencode = Arrow.Table(&quot;data/gencode/$(splitext(basename(url))[1]).arrow&quot;)|&gt; DataFrame
GeneticsMakie.findclosestgene(GeneticsMakie.findgwasloci(dfs[1]), gencode)</code></pre><pre><code class="language-julia hljs">gene = &quot;ACAN&quot;
chr, start, stop = GeneticsMakie.findgene(gene, gencode)
ranges = [start - 1e6, stop + 1e6]

n = length(dfs)
titles = [&quot;Height (Yengo et al. 2018)&quot;, &quot;Weight (Yengo et al. 2018)&quot;]
f = Figure(resolution = (306, 792))
axs = [Axis(f[i, 1]) for i in 1:(n + 1)]
for i in 1:n
    GeneticsMakie.plotlocus!(axs[i], chr, ranges[1], ranges[2], dfs[i])
    rowsize!(f.layout, i, 30)
    lines!(axs[i], ranges, fill(-log(10, 5e-8), 2), color = (:purple, 0.5), linewidth = 0.5)
    Label(f[i, 1, Top()], &quot;$(titles[i])&quot;, fontsize = 6, halign = :left, padding = (7.5, 0, -5, 0))
end
rs = GeneticsMakie.plotgenes!(axs[n + 1], chr, ranges[1], ranges[2], gencode; height = 0.1)
rowsize!(f.layout, n + 1, rs)
GeneticsMakie.labelgenome(f[n + 1, 1, Bottom()], chr, ranges[1], ranges[2])
Colorbar(f[1:n, 2], limits = (0, 1), ticks = 0:1:1, height = 20,
    colormap = [:gray60, :red2], label = &quot;LD&quot;, ticksize = 0, tickwidth = 0,
    tickalign = 0, ticklabelsize = 6, flip_vertical_label = true,
    labelsize = 6, width = 5, spinewidth = 0.5)
Label(f[1:n, 0], text = &quot;-log[p]&quot;, fontsize = 6, rotation = pi / 2)
rowgap!(f.layout, 5)
colgap!(f.layout, 5)
for i in 1:(n + 1)
    vlines!(axs[i], start, color = (:gold, 0.5), linewidth = 0.5)
    vlines!(axs[i], stop, color = (:gold, 0.5), linewidth = 0.5)
end
resize_to_layout!(f)
f</code></pre><p><img src="../../figs/ACAN-locuszoom.png" alt/></p><p>To color variants by linkage disequilibrium (LD), we need a reference panel. If we already have one, we can use <a href="https://openmendel.github.io/SnpArrays.jl/latest/"><strong>SnpArrays.jl</strong></a> to read in PLINK bed files. Otherwise, we download and load pre-processed 1000 Genomes reference panel for chromosome 15.</p><pre><code class="language-julia hljs">isdir(&quot;data/1kg&quot;) || mkdir(&quot;data/1kg&quot;)
for plink in [&quot;bed&quot;, &quot;bim&quot;, &quot;fam&quot;]
    Downloads.download(&quot;https://github.com/mmkim1210/GeneticsMakieExamples/raw/master/data/kgp.chr15.$(plink)&quot;, &quot;data/1kg/kgp.chr15.$(plink)&quot;)
end
kgp = SnpData(&quot;data/1kg/kgp.chr15&quot;)</code></pre><div class="admonition is-info"><header class="admonition-header">Processing LD reference panel</header><div class="admonition-body"><p>1000 Genomes genotype array data is publicly available, which can be downloaded and processed using <a href="https://github.com/mmkim1210/1kg">these example scripts</a>.</p></div></div><p>We can then color variants by LD with the index/sentinel SNP by using the <code>ld</code> keyword argument.</p><pre><code class="language-julia hljs">f = Figure(resolution = (306, 792))
axs = [Axis(f[i, 1]) for i in 1:(n + 1)]
for i in 1:n
    GeneticsMakie.plotlocus!(axs[i], chr, ranges[1], ranges[2], dfs[i]; ld = kgp)
    rowsize!(f.layout, i, 30)
    lines!(axs[i], ranges, fill(-log(10, 5e-8), 2), color = (:purple, 0.5), linewidth = 0.5)
    Label(f[i, 1, Top()], &quot;$(titles[i])&quot;, fontsize = 6, halign = :left, padding = (7.5, 0, -5, 0))
end
rs = GeneticsMakie.plotgenes!(axs[n + 1], chr, ranges[1], ranges[2], gencode; height = 0.1)
rowsize!(f.layout, n + 1, rs)
GeneticsMakie.labelgenome(f[n + 1, 1, Bottom()], chr, ranges[1], ranges[2])
Colorbar(f[1:n, 2], limits = (0, 1), ticks = 0:1:1, height = 20,
    colormap = [:gray60, :red2], label = &quot;LD&quot;, ticksize = 0, tickwidth = 0,
    tickalign = 0, ticklabelsize = 6, flip_vertical_label = true,
    labelsize = 6, width = 5, spinewidth = 0.5)
Label(f[1:n, 0], text = &quot;-log[p]&quot;, fontsize = 6, rotation = pi / 2)
rowgap!(f.layout, 5)
colgap!(f.layout, 5)
for i in 1:(n + 1)
    vlines!(axs[i], start, color = (:gold, 0.5), linewidth = 0.5)
    vlines!(axs[i], stop, color = (:gold, 0.5), linewidth = 0.5)
end
resize_to_layout!(f)
f</code></pre><p><img src="../../figs/ACAN-locuszoom-ld.png" alt/></p><p>We can also color variants by LD with the same SNP by using the <code>ld</code> keyword argument.</p><pre><code class="language-julia hljs">f = Figure(resolution = (306, 792))
axs = [Axis(f[i, 1]) for i in 1:(n + 1)]
for i in 1:n
    GeneticsMakie.plotlocus!(axs[i], chr, ranges[1], ranges[2], dfs[i]; ld = (kgp, (&quot;15&quot;, 89395626)))
    rowsize!(f.layout, i, 30)
    lines!(axs[i], ranges, fill(-log(10, 5e-8), 2), color = (:purple, 0.5), linewidth = 0.5)
    Label(f[i, 1, Top()], &quot;$(titles[i])&quot;, fontsize = 6, halign = :left, padding = (7.5, 0, -5, 0))
end
rs = GeneticsMakie.plotgenes!(axs[n + 1], chr, ranges[1], ranges[2], gencode; height = 0.1)
rowsize!(f.layout, n + 1, rs)
GeneticsMakie.labelgenome(f[n + 1, 1, Bottom()], chr, ranges[1], ranges[2])
Colorbar(f[1:n, 2], limits = (0, 1), ticks = 0:1:1, height = 20,
    colormap = [:gray60, :red2], label = &quot;LD&quot;, ticksize = 0, tickwidth = 0,
    tickalign = 0, ticklabelsize = 6, flip_vertical_label = true,
    labelsize = 6, width = 5, spinewidth = 0.5)
Label(f[1:n, 0], text = &quot;-log[p]&quot;, fontsize = 6, rotation = pi / 2)
rowgap!(f.layout, 5)
colgap!(f.layout, 5)
for i in 1:(n + 1)
    vlines!(axs[i], start, color = (:gold, 0.5), linewidth = 0.5)
    vlines!(axs[i], stop, color = (:gold, 0.5), linewidth = 0.5)
end
resize_to_layout!(f)
f</code></pre><p><img src="../../figs/ACAN-locuszoom-ld-snp.png" alt/></p><p>By using <a href="https://makie.juliaplots.org/stable/"><strong>Makie.jl</strong></a>&#39;s layout tools,  it becomes easy to draw additional tracks. For example, in a separate track,  the variants could be colored or could have varying sizes depending on their minor allele frequency.  In another example, the variants could be colored based on their inclusion in a  credible set post-fine-mapping.</p><div class="admonition is-info"><header class="admonition-header">Plotting the intersection of SNPs, not the union</header><div class="admonition-body"><p><code>GeneticsMakie.plotlocus!</code> plots only the variants that are present in the reference panel,  when the <code>ld</code> keyword argument is specified. Although SNPs that are missing in the reference panel could be plotted differently (e.g. with varying transparency and shape), <a href="https://github.com/mmkim1210/GeneticsMakie.jl"><strong>GeneticsMakie.jl</strong></a> is designed to visualize 100s of phenotypes simultaneously in which case such discrepancy is hard to tell and  is confusing. Hence, for more direct comparison of loci across phenotypes,  only the variants that are found in the reference panel are shown.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Extremely small P values</header><div class="admonition-body"><p>There are several GWAS loci that harbor extremely small P values, in which cases the P values will be clamped to the smallest floating point number. Such cases are going to be more common in phenotypes that are reaching saturation in terms of GWAS discovery (e.g. height). In those cases, it is more commonplace to observe allelic heterogneity, and it might be more appropriate to plot alternative measures of strength of association (e.g. Z scores).</p></div></div><div class="admonition is-info"><header class="admonition-header">Patterns of LD</header><div class="admonition-body"><p>Oftentimes, chunks of LD blocks hug a single or multiple gene boundaries.</p></div></div><div class="admonition is-success"><header class="admonition-header">Covering the entire genome</header><div class="admonition-body"><p>Visualizing 1,500 genomic regions with 2 Mb window will more or less cover the entire human genome. Note that empirically speaking, the probability of an arbitrary 2 Mb window  harboring at least one genome-wide significant hit across multiple phenotypes is  higher than not harboring any significant association.</p></div></div><div class="admonition is-info"><header class="admonition-header">Phenome-scale LocusZoom</header><div class="admonition-body"><p>To visualize 100s of phenotypes simultaneously, summary statistics or other relevant genomic annotations should be converted to memory friendly  <a href="https://github.com/apache/arrow-julia"><strong>Arrow.jl</strong></a> or  <a href="https://github.com/JuliaIO/Parquet.jl"><strong>Parquet.jl</strong></a> files.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../isoforms/">« Plotting isoforms</a><a class="docs-footer-nextpage" href="../gwas/">Plotting GWAS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Thursday 26 October 2023 21:27">Thursday 26 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
